@if (successfulRegister()) {
<app-alert-modal
  message="register succuss fully"
  [type]="'success'"
  [show]="false"
  (onClose)="onLoginRedirect()"
/>
}

<div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-sm">
    <h2
      class="mt-10 text-center text-2xl/9 font-bold tracking-tight text-gray-900"
    >
      Sign up
    </h2>
  </div>

  <div
    class="mt-10 sm:mx-auto sm:w-full sm:max-w-lg py-2 px-5 shadow-xl rounded bg-blue-100"
  >
    <div class="flex gap-1 h-2 overflow-hidden mt-4 px-6 py-3">
      <div
        class="grow p-1 -skew-x-12 bg-brand-blue-50"
        [class.bg-brand-blue-700]="step() === 1"
      ></div>
      <div
        class="grow p-1 -skew-x-12 bg-brand-blue-50"
        [class.bg-brand-blue-700]="step() === 2"
      ></div>
      <div
        class="grow p-1 -skew-x-12 bg-brand-blue-50"
        [class.bg-brand-blue-700]="step() === 3"
      ></div>
    </div>
    @if(step() === 1){
    <div class="flex flex-col gap-6 py-20 px-4">
      <button
        class="block cursor-pointer hover:shadow-lg hover:bg-brand-blue-700 focus:bg-brand-blue-700 transition duration-100 bg-brand-blue-600 text-blue-50 py-3 px-2 rounded-md"
        type="button"
        (click)="onRoleSelect('student')"
      >
        Join Placement Cell as a Student
      </button>
      <div class="sm:flex gap-3">
        <button
          class="block cursor-pointer w-full hover:shadow-lg hover:bg-brand-yellow-300 focus:bg-brand-yellow-300 transition durationduration-100 sm:w-1/5 grow bg-[#f99307] text-brand-yellow-950 font-semibold py-3 px-2 rounded-md"
          type="button"
          (click)="onRoleSelect('placement_cell')"
        >
          Signup as Placement Cell
        </button>
        <button
          class="block cursor-pointer w-full max-sm:mt-3 hover:shadow-lg hover:bg-brand-yellow-300 focus:bg-brand-yellow-300 transition durationduration-100 sm:w-1/5 grow bg-brand-yellow-500 text-brand-yellow-950 font-semibold py-3 px-2 rounded-md"
          type="button"
          (click)="onRoleSelect('recruiter')"
        >
          Signup as Recruiter
        </button>
      </div>
      @if(roleError()){
      <div class="text-red-500 text-xs text-center">Select Role</div>
      }
    </div>
    }@else if (step() === 2) {
    <form
      [formGroup]="userForm"
      (ngSubmit)="onUserFormValidate()"
      class="max-w-sm mx-auto"
    >
      <div class="mt-3">
        <label for="username" class="block text-sm/6 font-medium text-gray-900"
          >User name</label
        >
        <div class="mt-0.5">
          <input
            type="text"
            formControlName="username"
            name="username"
            id="username"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>

        @if (username?.invalid && (username?.dirty || username?.touched)) {
        @if(username?.hasError("required")){
        <div class="text-red-500 text-xs">Username is required.</div>
        }@if(username?.hasError("server")){

        <div class="text-red-500 text-xs">
          {{ userForm.get("username")?.getError("server") }}
        </div>
        } }
      </div>
      <div class="mt-3 relative">
        <label for="email" class="block text-sm/6 font-medium text-gray-900"
          ><span>Email address</span>
        </label>
        @if (selectedRole === "student") {
        <span class="absolute top-0 right-0 text-xs text-gray-500"
          >Make sure to use your college email</span
        >
        }
        <div class="mt-0.5">
          <input
            type="email"
            name="email"
            id="email"
            formControlName="email"
            autocomplete="email"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />

          @if (emailError()) {
          <div class="text-red-500 text-xs">
            {{ emailError() }}
          </div>
          } @else if (userForm.get('email')?.invalid &&
          (userForm.get('email')?.dirty || userForm.get('email')?.touched)) {
          @if (userForm.get('email')?.hasError('required')) {
          <div class="text-red-500 text-xs">Email is required.</div>
          } @else if (userForm.get('email')?.hasError('email')) {
          <div class="text-red-500 text-xs">Please enter valid email</div>
          } }
        </div>
      </div>

      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label
            for="password"
            class="block text-sm/6 font-medium text-gray-900"
            >Password</label
          >
        </div>
        <div class="mt-0.5">
          <input
            type="password"
            name="password"
            id="password"
            formControlName="password"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>
        @if (password?.invalid && (password?.dirty || password?.touched)) {
        @if(password?.hasError("required")) {
        <div class="text-red-500 text-xs">Password is required.</div>
        } @else if(password?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Password must be at least 6 characters.
        </div>
        } @else if(password?.hasError("server")){
        <div class="text-red-500 text-xs">
          {{ userForm.get("password")?.getError("server") }}
        </div>
        }}
      </div>
      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label
            for="confirmPassword"
            class="block text-sm/6 font-medium text-gray-900"
            >Confirm Password</label
          >
        </div>
        <div class="mt-0.5">
          <input
            type="password"
            name="confirmPassword"
            id="confirmPassword"
            formControlName="confirmPassword"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>
        <!-- Error handling for confirm password -->
        @if (confirmPassword?.invalid && (confirmPassword?.dirty ||
        confirmPassword?.touched)) { @if(confirmPassword?.hasError("required"))
        {
        <div class="text-red-500 text-xs">Confirm password is required.</div>
        }@else if(confirmPassword?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Confirm password must be at least 6 characters.
        </div>
        } }

        <!-- Check for custom password mismatch error on the entire form group -->
        @if(confirmPassword?.parent?.hasError("passwordsMismatch") &&
        (confirmPassword?.dirty || confirmPassword?.touched)) {
        <div class="text-red-500 text-xs">Password do not match.</div>
        } @else if(confirmPassword?.hasError("server")){
        <div class="text-red-500 text-xs">
          {{ userForm.get("confirmPassword")?.getError("server") }}
        </div>
        }
      </div>

      <div class="flex gap-3 mt-3">
        <button
          (click)="onPreviousStep()"
          class="block cursor-pointer hover:shadow-lg hover:bg-brand-blue-600 focus:bg-brand-blue-600 transition durationduration-100 w-1/5 grow bg-brand-blue-700 text-blue-50 py-2 px-1 rounded-md"
          type="button"
        >
          Back
        </button>
        <button
          class="block cursor-pointer hover:shadow-lg hover:bg-brand-blue-600 focus:bg-brand-blue-600 transition durationduration-100 w-1/5 grow bg-brand-blue-700 text-blue-50 py-2 px-1 rounded-md"
          type="submit"
        >
          Next
        </button>
      </div>
    </form>
    }@else if(step() === 3){

    <form [formGroup]="profileForm" (ngSubmit)="onRegisterSubmit()">
      @if(selectedRole === "recruiter"){
      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label
            for="companyName"
            class="block text-sm/6 font-medium text-gray-900"
            >Company Name</label
          >
        </div>
        <div class="mt-0.5">
          <input
            type="text"
            name="companyName"
            id="companyName"
            formControlName="companyName"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>
        <!-- Error handling for confirm password -->
        @if (confirmPassword?.invalid && (confirmPassword?.dirty ||
        confirmPassword?.touched)) { @if(confirmPassword?.hasError("required"))
        {
        <div class="text-red-500 text-xs">Confirm password is required.</div>
        }@else if(confirmPassword?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Confirm password must be at least 6 characters.
        </div>
        } }
      </div>
      <!-- representativePosition -->
      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label
            for="representativePosition"
            class="block text-sm/6 font-medium text-gray-900"
            >Representative Position</label
          >
        </div>
        <div class="mt-0.5">
          <input
            type="text"
            name="representativePosition"
            id="representativePosition"
            formControlName="representativePosition"
            placeholder="your role in company"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>
        <!-- Error handling for confirm password -->
        @if (confirmPassword?.invalid && (confirmPassword?.dirty ||
        confirmPassword?.touched)) { @if(confirmPassword?.hasError("required"))
        {
        <div class="text-red-500 text-xs">Confirm password is required.</div>
        }@else if(confirmPassword?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Confirm password must be at least 6 characters.
        </div>
        } }
      </div>
      <!-- description -->
      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label
            for="description"
            class="block text-sm/6 font-medium text-gray-900"
            >Description</label
          >
        </div>
        <div class="mt-0.5">
          <textarea
            type="text"
            name="description"
            id="description"
            formControlName="description"
            placeholder="Provide brief description about company"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          ></textarea>
        </div>
        <!-- Error handling for confirm password -->
        @if (confirmPassword?.invalid && (confirmPassword?.dirty ||
        confirmPassword?.touched)) { @if(confirmPassword?.hasError("required"))
        {
        <div class="text-red-500 text-xs">Confirm password is required.</div>
        }@else if(confirmPassword?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Confirm password must be at least 6 characters.
        </div>
        } }
      </div>
      <!-- website -->
      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label for="website" class="block text-sm/6 font-medium text-gray-900"
            >Website</label
          >
        </div>
        <div class="mt-0.5">
          <input
            type="text"
            name="website"
            id="website"
            formControlName="website"
            placeholder="Company's website"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>
        <!-- Error handling for confirm password -->
        @if (confirmPassword?.invalid && (confirmPassword?.dirty ||
        confirmPassword?.touched)) { @if(confirmPassword?.hasError("required"))
        {
        <div class="text-red-500 text-xs">Confirm password is required.</div>
        }@else if(confirmPassword?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Confirm password must be at least 6 characters.
        </div>
        } }
      </div>
      <!-- email -->
      <div class="mt-3">
        <div class="flex items-center justify-between">
          <label for="email" class="block text-sm/6 font-medium text-gray-900"
            >email</label
          >
        </div>
        <div class="mt-0.5">
          <input
            type="text"
            name="email"
            id="email"
            formControlName="email"
            placeholder="Company's contact email"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
        </div>
        <!-- Error handling for confirm password -->
        @if (confirmPassword?.invalid && (confirmPassword?.dirty ||
        confirmPassword?.touched)) { @if(confirmPassword?.hasError("required"))
        {
        <div class="text-red-500 text-xs">Confirm password is required.</div>
        }@else if(confirmPassword?.hasError("minlength")) {
        <div class="text-red-500 text-xs">
          Confirm password must be at least 6 characters.
        </div>
        } }
      </div>
      }@else if (selectedRole === 'student') {

      <!-- enrollmentNumber -->
      <div class="mt-3">
        <label
          for="enrollmentNumber"
          class="block text-sm/6 font-medium text-gray-900"
        >
          Enrollment number
        </label>
        <div class="mt-0.5">
          <input
            type="text"
            id="enrollmentNumber"
            placeholder="128734342"
            formControlName="enrollmentNumber"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
          @if (profileForm.get('enrollmentNumber')?.touched &&
          profileForm.get('enrollmentNumber')?.invalid) { @if
          (profileForm.get('enrollmentNumber')?.hasError('required')) {
          <div class="text-red-500 text-xs">Enrollment number is required.</div>
          } @else if (profileForm.get('enrollmentNumber')?.hasError('server')) {
          <div class="text-red-500 text-xs">
            {{ profileForm.get("enrollmentNumber")?.getError("server") }}
          </div>
          } }
        </div>
      </div>

      <!-- fullName -->
      <div class="mt-3">
        <label for="fullName" class="block text-sm/6 font-medium text-gray-900">
          Full Name
        </label>
        <div class="mt-0.5">
          <input
            type="text"
            id="fullName"
            placeholder="Full name as per your college ID"
            formControlName="fullName"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6"
          />
          @if (profileForm.get('fullName')?.touched &&
          profileForm.get('fullName')?.invalid) { @if
          (profileForm.get('fullName')?.hasError('required')) {
          <div class="text-red-500 text-xs">Full name is required.</div>
          } @else if (profileForm.get('fullName')?.hasError('server')) {
          <div class="text-red-500 text-xs">
            {{ profileForm.get("fullName")?.getError("server") }}
          </div>
          } }
        </div>
      </div>

      <!-- Branch -->
      <div class="mt-3">
        <label
          for="branch"
          class="block mb-2 text-sm font-medium text-gray-900"
        >
          Select your branch
        </label>
        <select
          id="branch"
          formControlName="branchId"
          class="bg-white text-gray-900 text-sm rounded-lg focus:ring-indigo-600 focus:border-indigo-600 block w-full p-2.5 outline-1 -outline-offset-1 outline-gray-300"
        >
          <option selected disabled>
            Choose a branch to find your placement cell
          </option>
          @for (branch of branches(); track branch.branchId) {
          <option [value]="branch.branchId">{{ branch.name }}</option>
          }
        </select>
        @if (profileForm.get('branchId')?.touched &&
        profileForm.get('branchId')?.invalid) { @if
        (profileForm.get('branchId')?.hasError('required')) {
        <div class="text-red-500 text-xs">Branch selection is required.</div>
        } @else if (profileForm.get('branchId')?.hasError('server')) {
        <div class="text-red-500 text-xs">
          {{ profileForm.get("branchId")?.getError("server") }}
        </div>
        } }
      </div>

      <!-- placementCellId -->
      <div class="mt-3">
        <label
          for="placementCellId"
          class="block mb-2 text-sm font-medium text-gray-900"
        >
          Select your placement cell
        </label>
        <app-auto-complete
          [options]="placementCellAutoCompleteList()"
          placeHolder="Select PlacementCell"
          (valueSelected)="onSelectedPlacementCell($event)"
        />
        @if (profileForm.get('placementCellId')?.touched &&
        profileForm.get('placementCellId')?.invalid) { @if
        (profileForm.get('placementCellId')?.hasError('required')) {
        <div class="text-red-500 text-xs">
          Placement cell selection is required.
        </div>
        } @else if (profileForm.get('placementCellId')?.hasError('server')) {
        <div class="text-red-500 text-xs">
          {{ profileForm.get("placementCellId")?.getError("server") }}
        </div>
        } }
      </div>

      <!-- degreeId -->
      <div class="mt-3">
        <label
          for="degreeId"
          class="block mb-2 text-sm font-medium text-gray-900"
        >
          Select your degree/course
        </label>
        <select
          id="degreeId"
          formControlName="degreeId"
          class="bg-white text-gray-900 text-sm rounded-lg focus:ring-indigo-600 focus:border-indigo-600 block w-full p-2.5 outline-1 -outline-offset-1 outline-gray-300"
        >
          <option selected disabled>Choose a degree/course</option>
          @for (degree of placementCellDegrees(); track degree.degreeId) {
          <option [value]="degree.degreeId">{{ degree.name }}</option>
          }
        </select>
        @if (profileForm.get('degreeId')?.touched &&
        profileForm.get('degreeId')?.invalid) { @if
        (profileForm.get('degreeId')?.hasError('required')) {
        <div class="text-red-500 text-xs">Degree selection is required.</div>
        } @else if (profileForm.get('degreeId')?.hasError('server')) {
        <div class="text-red-500 text-xs">
          {{ profileForm.get("degreeId")?.getError("server") }}
        </div>
        } }
      </div>

      } @else if(selectedRole === "placement_cell"){
      <!-- Name -->
      <div class="mt-3">
        <label for="name" class="block text-sm font-medium text-gray-900">
          Name
        </label>
        <div class="mt-0.5">
          <input
            type="text"
            id="name"
            formControlName="name"
            placeholder="Enter placement cell name"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm"
          />
          @if (profileForm.get('name')?.touched &&
          profileForm.get('name')?.invalid) { @if
          (profileForm.get('name')?.hasError('required')) {
          <div class="text-red-500 text-xs">Name is required.</div>
          } }
        </div>
      </div>

      <!-- Domains -->
      <div class="mt-3">
        <label class="block text-sm font-medium text-gray-900">Domains</label>
        <app-auto-complete
          placeHolder="Add domain"
          (valueSelected)="onDomainAdded($event)"
        />
        <button
          type="button"
          (click)="addDomain()"
          class="mt-2 inline-flex items-center rounded-md bg-indigo-600 px-2.5 py-1.5 text-xs font-semibold text-white hover:bg-indigo-500"
        >
          Add Domain
        </button>
        <ul class="mt-2 list-disc pl-5 text-sm text-gray-700">
          <li *ngFor="let domain of placementCellAddedDomains()">
            {{ domain }}
          </li>
        </ul>
      </div>

      <!-- Branch -->
      <div class="mt-3">
        <label for="branch" class="block text-sm font-medium text-gray-900">
          Select Branch
        </label>
        <div class="mt-0.5">
          <select
            id="branch"
            formControlName="branchName"
            class="bg-white text-gray-900 text-sm rounded-md focus:ring-indigo-600 focus:border-indigo-600 block w-full p-2.5 outline-1 -outline-offset-1 outline-gray-300"
          >
            <option selected disabled>Select Branch</option>
            @for (branch of branches(); track branch.branchId) {
            <option [value]="branch.name">{{ branch.name }}</option>
            }
          </select>
          @if (profileForm.get('branchName')?.touched &&
          profileForm.get('branchName')?.invalid) { @if
          (profileForm.get('branchName')?.hasError('required')) {
          <div class="text-red-500 text-xs">Branch is required.</div>
          } }
        </div>
      </div>
      <!-- Degree -->
      <div class="mt-3">
        <label class="block text-sm font-medium text-gray-900">Domains</label>
        <app-auto-complete
          [options]="placementCellDegreeAutoCompleteList()"
          placeHolder="Add domain"
          (valueSelected)="onDegreeAdded($event)"
        />
        <button
          type="button"
          (click)="addDegree()"
          class="mt-2 inline-flex items-center rounded-md bg-indigo-600 px-2.5 py-1.5 text-xs font-semibold text-white hover:bg-indigo-500"
        >
          Add Degree
        </button>
        <ul class="mt-2 list-disc pl-5 text-sm text-gray-700">
          <li *ngFor="let domain of placementCellAddedDegrees()">
            {{ domain }}
          </li>
        </ul>
      </div>

      <!-- Email -->
      <div class="mt-3">
        <label for="email" class="block text-sm font-medium text-gray-900">
          Email
        </label>
        <div class="mt-0.5">
          <input
            type="email"
            id="email"
            placeholder="Enter email"
            formControlName="email"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm"
          />
          @if (profileForm.get('email')?.touched &&
          profileForm.get('email')?.invalid) { @if
          (profileForm.get('email')?.hasError('required')) {
          <div class="text-red-500 text-xs">Email is required.</div>
          } @else if (profileForm.get('email')?.hasError('email')) {
          <div class="text-red-500 text-xs">Invalid email address.</div>
          } }
        </div>
      </div>

      <!-- Website -->
      <div class="mt-3">
        <label for="website" class="block text-sm font-medium text-gray-900">
          Website
        </label>
        <div class="mt-0.5">
          <input
            type="url"
            id="website"
            placeholder="https://example.com"
            formControlName="website"
            class="block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm"
          />
          @if (profileForm.get('website')?.touched &&
          profileForm.get('website')?.invalid) { @if
          (profileForm.get('website')?.hasError('required')) {
          <div class="text-red-500 text-xs">Website is required.</div>
          } }
        </div>
      </div>
      }
      <div class="flex gap-3 mt-2">
        <button
          (click)="onPreviousStep()"
          class="block cursor-pointer hover:shadow-lg hover:bg-brand-blue-600 focus:bg-brand-blue-600 transition durationduration-100 w-1/5 grow bg-brand-blue-700 text-blue-50 py-2 px-1 rounded-md"
          type="button"
        >
          Back
        </button>
        <button
          class="block cursor-pointer hover:shadow-lg hover:bg-green-700 focus:bg-green-700 transition durationduration-100 w-1/5 grow bg-emerald-800 text-blue-50 py-3 px-2 rounded-md"
          type="submit"
        >
          Submit
        </button>
      </div>
    </form>
    }
    <p
      class="text-sm text-center font-light text-gray-500 dark:text-gray-400 mt-1"
    >
      Already have an account yet?
      <a
        routerLink="/auth/login"
        class="font-medium text-primary-600 hover:underline dark:text-primary-500 cursor-pointer"
        >Sign in</a
      >
    </p>
  </div>
</div>
